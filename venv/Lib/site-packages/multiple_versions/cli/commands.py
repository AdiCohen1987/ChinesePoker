"""
Provide implementation of command-line interface.
"""
import sys

import click

from multiple_versions.cli.help import (
    NAME_HELP,
    VERSION_HELP,
    EXTRA_INDEX_URL,
)
from multiple_versions.constants import (
    SUCCESSFUL_EXIT_CODE,
)
from multiple_versions.services.pip3 import Pip3
from multiple_versions.services.package import Package
from multiple_versions.services.site_packages import SitePackages


@click.group('package', chain=True)
def package_commands() -> None:
    """
    Provide commands for working with package.
    """
    pass


@click.option('--name', required=True, type=str, help=NAME_HELP)
@click.option('--version', required=True, type=str, help=VERSION_HELP)
@click.option('--extra-index-url', required=False, default=None, type=str, help=EXTRA_INDEX_URL)
@package_commands.command('install')
def install(name: str, version: str, extra_index_url: str) -> None:
    """
    Install a package.

    The common place to store packages installed by pip3 is something similar to —
    `/Library/Frameworks/Python/Versions/3.7/lib/python3.7/site-packages`.

    With pip3-multiple packages, all packages are installed to the following folder –
    `/Library/Frameworks/Python/Versions/3.7/lib/python3.7/site-packages/pip3-multiple-versions-site-packages`.

    Arguments:
        name (str): name of a package to install.
        version (str): Version of a package to install.
        extra_index_url (int): URL to extra Python Package Index. Maybe private one.

    Returns:
        None.
    """
    site_packages = SitePackages()
    site_packages.create()

    package = Package(name=name, version=version, site_packages=site_packages)

    pip3 = Pip3(site_packages=site_packages, extra_index_url=extra_index_url)
    pip3.install(package=package)

    sys.exit(SUCCESSFUL_EXIT_CODE)
